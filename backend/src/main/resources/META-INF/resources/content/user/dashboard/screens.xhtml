<?xml version="1.0" encoding="UTF-8"?>
<ui:composition xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
                xmlns="http://www.w3.org/1999/xhtml"
                xmlns:c="http://java.sun.com/jsp/jstl/core"
                xmlns:h="http://java.sun.com/jsf/html"
                xmlns:jsf="http://xmlns.jcp.org/jsf"
                xmlns:p="http://primefaces.org/ui">

    <p:dialog header="#{msg['app.user.screen.title']}"
              widgetVar="screens-dialog"
              minHeight="40"
              modal="true"
              width="70%"
              resizable="false"
              responsive="true"
              draggable="false"
              closeOnEscape="true"
              dynamic="true">
        <h:form id="widget-screen-form">
            <p:defaultCommand target="submit-code" />
            <div jsf:id="screen-dialog-content" class="settings-dialog">
                <div class="panel-heading clearfix">
                    <h3 class="panel-title">#{msg['app.user.screen.add.new']}</h3>
                </div>
                <div class="panel-body" jsf:id="registerScreen">
                    <label for="registerTV">#{msg['app.user.register.tv']}</label>
                    <p:messages for="registerTV" showIcon="false"/>
                    <div class="form-inline #{!registerTV.valid ? 'has-error' : ''}">
                        <p:inputText binding="#{ registerTV }"
                                     id="registerTV"
                                     required="true"
                                     requiredMessage="#{msg['app.user.field.code.required']}"
                                     style="width:150px"
                                     styleClass="form-control"
                                     value="#{ScreensManagedBean.screenCode}"/>
                        <p:commandButton actionListener="#{ScreensManagedBean.registerScreen}"
                                         class="btn btn-primary"
                                         update="registerScreen"
                                         id="submit-code"
                                         value="#{msg['app.user.register.tv.btn']}"
                                         oncomplete="if(!args.validationFailed){ PF('screens-dialog').hide();}"
                                         process="registerScreen" />
                    </div>
                </div>

                <c:if test="#{ScreensManagedBean.getClientNumber() gt 0}">
                    <div class="panel-heading clearfix">
                        <h3 class="panel-title">#{msg['app.user.screen.currently.linked']} - #{ScreensManagedBean.getClientNumber()} #{msg['app.user.dashboard.client.number']}</h3>
                    </div>
                    <div class="panel-body" >
                        <div class="ui-g" style="margin-bottom: 15px;">
                            <c:forEach items="#{ScreensManagedBean.clients}" var="client">
                                <div class="ui-g-4 text-center">
                                    <i class="fa fa-2x fa-desktop" aria-hidden="true" style="margin-right: 5px"/><p class="inline-code">#{msg['app.user.screen.code']} #{client.id}</p>
                                    <p:commandButton actionListener="#{ScreensManagedBean.disconnectScreen(client)}"
                                                     class="btn btn-xs btn-primary btn-disconnect"
                                                     update="messages"
                                                     value="#{msg['app.user.screen.unregister.btn']}"
                                                     process="@this"
                                                     oncomplete="PF('screens-dialog').hide();"
                                    />
                                </div>
                            </c:forEach>
                        </div>
                        <p:commandLink actionListener="#{ScreensManagedBean.displayNumber}" process="@this">
                            <i class="fa fa-angle-right" aria-hidden="true"/> #{msg['app.user.screen.code.screen.btn']}
                        </p:commandLink>
                    </div>
                </c:if>
            </div>
            <input name="#{_csrf.parameterName}" type="hidden" value="#{_csrf.token}"/>
        </h:form>
    </p:dialog>
</ui:composition>