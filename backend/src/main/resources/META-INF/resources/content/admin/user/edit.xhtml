<!-- Sources generated by springboot-scaffolding-maven-plugin  -->
<ui:composition
        template="/template/backoffice_layout.xhtml"
        xmlns="http://www.w3.org/1999/xhtml"
        xmlns:h="http://java.sun.com/jsf/html"
        xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
        xmlns:p="http://primefaces.org/ui"
        xmlns:c="http://java.sun.com/jsp/jstl/core"
>

    <ui:param name="pageName" value="#{msg['app.admin.user.title']}"/>
    <ui:param name="subPageName" value="#{ UserEditManagedBean.isEditing()? msg['app.admin.user.edit.title'] : msg['app.admin.user.create.title']}"/>

    <ui:define name="content">
        <div class="row">
            <div class="col-md-12">
                <div class="panel animated zoomIn">
                    <div class="panel-heading clearfix">
                        <h3 class="panel-title">#{ UserEditManagedBean.isEditing() ? msg['app.admin.user.edit.header'] : msg['app.admin.user.create.header']}</h3>
                    </div>
                    <div class="panel-body">

                        <h:form id="form">
                            <div class="form-group #{!username.valid ? 'has-error' : ''}">
                                <label for="username">#{msg['app.admin.user.field.username']} *</label>
                                <p:messages for="username" showIcon="false" />
                                <p:inputText id="username"
                                             value="#{ UserEditManagedBean.user.username}"
                                             placeholder="#{msg['app.admin.user.field.username.placeholder']}"
                                             styleClass="form-control"
                                required="true"
                                requiredMessage="#{msg['app.admin.user.field.username.required']}"
                                binding="#{ username }"
                                />
                            </div>

                            <h3 class="with-line no-padding">#{msg['app.admin.user.field.roles']}</h3>

                            <c:choose>
                                <c:when test="#{ empty UserEditManagedBean.getRoles()}">
                                    <div class="form-group">
                                        #{msg['app.admin.user.list.empty']}
                                    </div>
                                </c:when>
                                <c:otherwise>
                                    <div class="row clearfix">
                                        <c:forEach var="it" items="#{ UserEditManagedBean.getRoles()}">
                                            <div class="col-md-3 col-sm-2 many2many" >
                                                <c:set var="selectedItem" value="#{ UserEditManagedBean.isSelectedRole(it)}"/>
                                                <p:commandLink action="#{ UserEditManagedBean.toogleRole(it)}"
                                                               styleClass="sn-link #{selectedItem ? 'connected' : ''}"
                                                               immediate="true"
                                                               update="@this"
                                                >
                                                    <span>#{it.getExplicitName()}</span>
                                                    <c:if test="#{selectedItem}">
                                                        <em class="ion-ios-close-empty sn-link-close"/>
                                                    </c:if>
                                                </p:commandLink>
                                            </div>
                                        </c:forEach>
                                    </div>
                                </c:otherwise>
                            </c:choose>
                            <h3 class="with-line no-padding">#{msg['app.admin.user.field.projects']}</h3>

                            <c:choose>
                                <c:when test="#{ empty UserEditManagedBean.getProjects()}">
                                    <div class="form-group">
                                        #{msg['app.admin.user.list.empty']}
                                    </div>
                                </c:when>
                                <c:otherwise>
                                    <div class="row clearfix">
                                        <c:forEach var="it" items="#{ UserEditManagedBean.getProjects()}">
                                            <div class="col-md-3 col-sm-2 many2many" >
                                                <c:set var="selectedItem" value="#{ UserEditManagedBean.isSelectedProject(it)}"/>
                                                <p:commandLink action="#{ UserEditManagedBean.toogleProject(it)}"
                                                               styleClass="sn-link #{selectedItem ? 'connected' : ''}"
                                                               immediate="true"
                                                               update="@this"
                                                >
                                                    <span>#{it.getExplicitName()}</span>
                                                    <c:if test="#{selectedItem}">
                                                        <em class="ion-ios-close-empty sn-link-close"/>
                                                    </c:if>
                                                </p:commandLink>
                                            </div>
                                        </c:forEach>
                                    </div>
                                </c:otherwise>
                            </c:choose>

                            <div class="pull-right">
                                    <p:commandButton class="btn btn-danger btn-with-icon"
                                                 icon="fa fa-trash"
                                                 action="#{ UserEditManagedBean.delete()}"
                                                 value="#{msg['app.admin.user.delete']}"
                                                 rendered="#{ UserEditManagedBean.isEditing()}"
                                    >
                                        <p:confirm header="Confirmation" message="Are you sure?" icon="ui-icon-alert" />
                                    </p:commandButton>

                                    <p:commandButton class="btn btn-primary btn-with-icon"
                                              icon="fa fa-check"
                                              action="#{ UserEditManagedBean.save()}"
                                              update="@form"
                                              value="#{msg['app.admin.user.save']}"
                                    />

                                    <p:confirmDialog global="true" showEffect="fade" hideEffect="fade">
                                        <p:commandButton value="Yes" type="button" styleClass="ui-confirmdialog-yes btn btn-danger btn-xs" icon="fa fa-check" />
                                        <p:commandButton value="No" type="button" styleClass="ui-confirmdialog-no btn btn-primary btn-xs spaceleft" icon="fa fa-close" />
                                    </p:confirmDialog>
                            </div>
                            <input type="hidden"  name="#{_csrf.parameterName}"   value="#{_csrf.token}"/>
                        </h:form>
                    </div>
                </div>
            </div>
        </div>
    </ui:define>

</ui:composition>